{"version":3,"names":["useSelect","useDispatch","useEffect","useRef","useContext","store","blockEditorStore","unlock","BlockContext","useZoomOut","enabled","postId","setZoomLevel","resetZoomLevel","isZoomedOut","isZoomOut","select","_isZoomOut","controlZoomLevelRef","isEnabledRef","postIdRef","current"],"sources":["@wordpress/block-editor/src/hooks/use-zoom-out.js"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useSelect, useDispatch } from '@wordpress/data';\nimport { useEffect, useRef, useContext } from '@wordpress/element';\n\n/**\n * Internal dependencies\n */\nimport { store as blockEditorStore } from '../store';\nimport { unlock } from '../lock-unlock';\nimport BlockContext from '../components/block-context';\n\n/**\n * A hook used to set the editor mode to zoomed out mode, invoking the hook sets the mode.\n * Concepts:\n * - If we most recently changed the zoom level for them (in or out), we always resetZoomLevel() level when unmounting.\n * - If the user most recently changed the zoom level (manually toggling), we do nothing when unmounting.\n *\n * @param {boolean} enabled If we should enter into zoomOut mode or not\n */\nexport function useZoomOut( enabled = true ) {\n\tconst { postId } = useContext( BlockContext );\n\tconst { setZoomLevel, resetZoomLevel } = unlock(\n\t\tuseDispatch( blockEditorStore )\n\t);\n\n\t/**\n\t * We need access to both the value and the function. The value is to trigger a useEffect hook\n\t * and the function is to check zoom out within another hook without triggering a re-render.\n\t */\n\tconst { isZoomedOut, isZoomOut } = useSelect( ( select ) => {\n\t\tconst { isZoomOut: _isZoomOut } = unlock( select( blockEditorStore ) );\n\t\treturn {\n\t\t\tisZoomedOut: _isZoomOut(),\n\t\t\tisZoomOut: _isZoomOut,\n\t\t};\n\t}, [] );\n\n\tconst controlZoomLevelRef = useRef( false );\n\tconst isEnabledRef = useRef( enabled );\n\tconst postIdRef = useRef( postId );\n\n\t/**\n\t * This hook tracks if the zoom state was changed manually by the user via clicking\n\t * the zoom out button. We only want this to run when isZoomedOut changes, so we use\n\t * a ref to track the enabled state.\n\t */\n\tuseEffect( () => {\n\t\t// If the zoom state changed (isZoomOut) and it does not match the requested zoom\n\t\t// state (zoomOut), then it means the user manually changed the zoom state while\n\t\t// this hook was mounted, and we should no longer control the zoom state.\n\t\tif ( isZoomedOut !== isEnabledRef.current ) {\n\t\t\tcontrolZoomLevelRef.current = false;\n\t\t}\n\t}, [ isZoomedOut ] );\n\n\tuseEffect( () => {\n\t\tisEnabledRef.current = enabled;\n\n\t\t// If the user created a new post/page, we should take control of the zoom level.\n\t\tif ( postIdRef.current !== postId ) {\n\t\t\tcontrolZoomLevelRef.current = true;\n\t\t}\n\n\t\tif ( enabled !== isZoomOut() ) {\n\t\t\tcontrolZoomLevelRef.current = true;\n\n\t\t\tif ( enabled ) {\n\t\t\t\tsetZoomLevel( 'auto-scaled' );\n\t\t\t} else {\n\t\t\t\tresetZoomLevel();\n\t\t\t}\n\t\t}\n\n\t\treturn () => {\n\t\t\t// If we are controlling zoom level and are zoomed out, reset the zoom level.\n\t\t\tif ( controlZoomLevelRef.current && isZoomOut() ) {\n\t\t\t\tresetZoomLevel();\n\t\t\t}\n\t\t};\n\t}, [ enabled, isZoomOut, postId, resetZoomLevel, setZoomLevel ] );\n}\n"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,SAAS,EAAEC,WAAW,QAAQ,iBAAiB;AACxD,SAASC,SAAS,EAAEC,MAAM,EAAEC,UAAU,QAAQ,oBAAoB;;AAElE;AACA;AACA;AACA,SAASC,KAAK,IAAIC,gBAAgB,QAAQ,UAAU;AACpD,SAASC,MAAM,QAAQ,gBAAgB;AACvC,OAAOC,YAAY,MAAM,6BAA6B;;AAEtD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASC,UAAUA,CAAEC,OAAO,GAAG,IAAI,EAAG;EAC5C,MAAM;IAAEC;EAAO,CAAC,GAAGP,UAAU,CAAEI,YAAa,CAAC;EAC7C,MAAM;IAAEI,YAAY;IAAEC;EAAe,CAAC,GAAGN,MAAM,CAC9CN,WAAW,CAAEK,gBAAiB,CAC/B,CAAC;;EAED;AACD;AACA;AACA;EACC,MAAM;IAAEQ,WAAW;IAAEC;EAAU,CAAC,GAAGf,SAAS,CAAIgB,MAAM,IAAM;IAC3D,MAAM;MAAED,SAAS,EAAEE;IAAW,CAAC,GAAGV,MAAM,CAAES,MAAM,CAAEV,gBAAiB,CAAE,CAAC;IACtE,OAAO;MACNQ,WAAW,EAAEG,UAAU,CAAC,CAAC;MACzBF,SAAS,EAAEE;IACZ,CAAC;EACF,CAAC,EAAE,EAAG,CAAC;EAEP,MAAMC,mBAAmB,GAAGf,MAAM,CAAE,KAAM,CAAC;EAC3C,MAAMgB,YAAY,GAAGhB,MAAM,CAAEO,OAAQ,CAAC;EACtC,MAAMU,SAAS,GAAGjB,MAAM,CAAEQ,MAAO,CAAC;;EAElC;AACD;AACA;AACA;AACA;EACCT,SAAS,CAAE,MAAM;IAChB;IACA;IACA;IACA,IAAKY,WAAW,KAAKK,YAAY,CAACE,OAAO,EAAG;MAC3CH,mBAAmB,CAACG,OAAO,GAAG,KAAK;IACpC;EACD,CAAC,EAAE,CAAEP,WAAW,CAAG,CAAC;EAEpBZ,SAAS,CAAE,MAAM;IAChBiB,YAAY,CAACE,OAAO,GAAGX,OAAO;;IAE9B;IACA,IAAKU,SAAS,CAACC,OAAO,KAAKV,MAAM,EAAG;MACnCO,mBAAmB,CAACG,OAAO,GAAG,IAAI;IACnC;IAEA,IAAKX,OAAO,KAAKK,SAAS,CAAC,CAAC,EAAG;MAC9BG,mBAAmB,CAACG,OAAO,GAAG,IAAI;MAElC,IAAKX,OAAO,EAAG;QACdE,YAAY,CAAE,aAAc,CAAC;MAC9B,CAAC,MAAM;QACNC,cAAc,CAAC,CAAC;MACjB;IACD;IAEA,OAAO,MAAM;MACZ;MACA,IAAKK,mBAAmB,CAACG,OAAO,IAAIN,SAAS,CAAC,CAAC,EAAG;QACjDF,cAAc,CAAC,CAAC;MACjB;IACD,CAAC;EACF,CAAC,EAAE,CAAEH,OAAO,EAAEK,SAAS,EAAEJ,MAAM,EAAEE,cAAc,EAAED,YAAY,CAAG,CAAC;AAClE","ignoreList":[]}